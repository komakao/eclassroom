var quiz_definition = [
    [ // 測驗：變數
        {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '字串運算式'],
            'img': '/static/exam/A01.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '四則運算'],
            'img': '/static/exam/A02.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數'],
            'img': '/static/exam/A03.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '四則運算'],
            'img': '/static/exam/A04.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '四則運算'],
            'img': '/static/exam/A05.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '四則運算'],
            'img': '/static/exam/A06.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '字串運算式'],
            'img': '/static/exam/A07.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '運算式'],
            'img': '/static/exam/A08.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '運算式'],
            'img': '/static/exam/A09.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數'],
            'img': '/static/exam/A10.png',
        },
    ], [    // 測驗：選擇結構
        {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構'],
            'img': '/static/exam/B01.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構'],
            'img': '/static/exam/B02.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構'],
            'img': '/static/exam/B03.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構'],
            'img': '/static/exam/B04.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構'],
            'img': '/static/exam/B05.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構', '字串運算式'],
            'img': '/static/exam/B06.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構'],
            'img': '/static/exam/B07.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '邏輯運算式', '選擇結構'],
            'img': '/static/exam/B08.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '邏輯運算式', '選擇結構'],
            'img': '/static/exam/B09.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '邏輯運算式', '選擇結構'],
            'img': '/static/exam/B10.png',
        }, 
    ], [    // 測驗：控制結構
        {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '計次式迴圈'],
            'img': '/static/exam/C01.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '運算式', '計次式迴圈'],
            'img': '/static/exam/C02.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '計次式迴圈'],
            'img': '/static/exam/C03.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式', '選擇結構', '計次式迴圈'],
            'img': '/static/exam/C04.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '計次式迴圈'],
            'img': '/static/exam/C05.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '計次式迴圈', '運算式'],
            'img': '/static/exam/C06.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '計次式迴圈'],
            'img': '/static/exam/C07.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式迴圈'],
            'img': '/static/exam/C08.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式迴圈'],
            'img': '/static/exam/C09.png',
        }, {
            'title': '將以下的程式碼寫在貓咪角色上，執行結果貓咪會說什麼？',
            'concept': ['變數', '條件式迴圈', '邏輯運算式', '字串運算式'],
            'img': '/static/exam/C10.png',
        },
    ],
];
//---------------------------------------------------------------------------
// Vue settings
var app = new Vue({
    el: '#quizsets', 
    data: {
        quiz_sets: quiz_definition,
    },
});

//---------------------------------------------------------------------------
$(document).ready(function(){
    // 預設顯示第一個頁籤
    $('#tab1').addClass('show active');

    $('#score_tab').click(function(){
        $("#scoreboard").html("成績更新中，請稍待...");
        $("#scoreboard").load("/student/exam/score");
    });
    //
    var highlight_class = 'bg-warning';
    $(".answer_list li").click(function(){
        var index = $(this).parent().children().index(this);
        var ans = String.fromCharCode(65+index);
        var prev_ans = $("input", $(this).parent().parent()).val();
        $(this).parent().children().removeClass(highlight_class);
        if (prev_ans != ans) {
            $(this).addClass(highlight_class);
            $("input", $(this).parent().parent()).val(ans);
        } else {
            $("input", $(this).parent().parent()).val('');
        }
    });
    //
    //
    $('input.quiz-submit').click(function(e){
        var btn_instance = this;
        var ans=[];
        var ansmap=[];
        var examid = $(this).data('examid');
        var valid=true;
        var unfilled=null;
        var tmp;
        var pid;
        
        e.preventDefault();
        $('#tab'+examid+" .quiz").each(function(index){
            tmp = $("input", this).val();
            ansmap.push(pid = ($(this).data('pid')-1));
            ans[pid] = tmp;
            if (tmp == "") {
                if (unfilled == null)
                    unfilled = this;
                valid = false;	
            }
        });
        $('#tab'+examid+' .quiz').removeClass("unfilled");
        if (!valid) {
            alert("有題目忘記作答囉!!");
            $("html, body").animate({
                scrollTop: $(unfilled).offset().top
            }, 1000);
            $(unfilled).addClass("unfilled");
            return false;
        }
        $('#tab'+examid+" .answer_list li").off('click');
        $('#tab'+examid+" .answer_list li").css("cursor", "default");
        var ansstr = ans.join();
        $.post('/student/exam_check/',
            {
                'examid': examid, 
                'answer': ans.join(),
            },
            function(data){
                var tmpans = data['answer'].split(',');
                var ans = [];
                var len = tmpans.length;
                for (i = 0; i < len; ++i) {
                    ans[i] = tmpans[ansmap[i]];
                }
                $('#tab'+examid+' .answer_list img').remove();
                $('#tab'+examid+" input[name='ans']").removeClass("bg-success bg-danger");
                $('#tab'+examid+" input[name='ans']").each(function(index){
                    $('li', $(this).parent()).eq(ans[index].charCodeAt(0)-65).append("<img src='/static/images/tick-20.png' />");
                    if ($(this).val() == ans[index])
                        $(this).addClass('bg-success');
                    else {
                        $(this).addClass('bg-danger');
                        if ($(this).val() != '')
                            $('li', $(this).parent()).eq($(this).val().charCodeAt(0)-65).append("<img src='/static/images/cross-20.png' />");
                    }
                });
                $(btn_instance).hide();
            }
        );
    });
    //
    //
    (function($){
        $.fn.shuffle = function() {
            return this.each(function(){
                var items = $(this).children().clone(true);
                return (items.length) ? $(this).html($.shuffle(items)) : this;
            });
        }
        $.shuffle = function(arr) {
            for(var j, x, i = arr.length; i; j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x);
            return arr;
        }
    })(jQuery);
    //
    // 打亂題目次序
    $('.quiz_container').each(function(){
        var container = this;
        $(container).shuffle();
        var btn = $('input[type="button"]', $(container)).detach();
        btn.appendTo($(container));
        var pid = 1;
        $(".pid", $(container)).each(function() {
            $(this).text(pid);
            ++pid;
        });
    });
});